<!DOCTYPE html>
<html lang="zh-cn"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="æŸäº› STL å®¹å™¨ åœ¨åˆ· leetcodeï¼Œå…¶ä¸­æŸé“é¢˜ä¸­çš„ä»£ç ç‰‡æ®µæ˜¯è¿™æ ·çš„
string res; res.resize(size - i); // res.reserve(size - i); for (int j = 0; i &lt; size; i &#43;= 1, j &#43;= 1) { res[j] = arr[i] &#43; &#39;0&#39;; // res.push_back(arr[i] &#43; &#39;0&#39;); } æ²¡æ³¨é‡Šçš„ä»£ç æ¯”æ³¨é‡Šçš„å¿«äº†å‡ msï¼ŒåŸå› å¦‚ä¸‹
å› ä¸ºå®¹å™¨ä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼Œä¸éœ€è¦è€ƒè™‘æ‹·è´åŸæ¥çš„å…ƒç´ 
resize é‡æ–°åˆ†é…å†…å­˜å¹¶ä¸”é»˜è®¤åˆå§‹åŒ–ï¼Œsize æ”¹å˜ï¼ˆå¤§æ¦‚å¼€é”€ malloc &#43; memsetï¼‰ reserve é‡æ–°åˆ†é…äº†å†…å­˜ï¼Œä¸åˆå§‹åŒ–ï¼Œsize ä¸å˜ push_back éœ€è¦æ£€æŸ¥ size æœ‰æ²¡æœ‰å¤§äº capacityï¼Œå¤šäº†åˆ†æ”¯çš„å¼€é”€ ç„¶è€Œè¿™é‡Œä»£ç ä¹Ÿä¸æ˜¯æœ€å¿«çš„ï¼Œæ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡Œ resize è¿˜å¤šäº†ä¸€ä¸ª memset çš„å¼€é”€ï¼Œæ‰€ä»¥æœ€ä¼˜è§£åº”è¯¥æ˜¯ï¼Œç”¨è‡ªå·±å†™çš„ vectorï¼ˆé€ƒ
ä¸çŸ¥é“æ˜¯å†å²åŸå› è¿˜æ˜¯æ ‡å‡†å§”å‘˜ä¼šæ ¹æœ¬æ²¡è€ƒè™‘åˆ°ï¼Œåº”è¯¥åŠ å¤šå‡ ä¸ªå‡½æ•°æ¥è¡¨ç¤ºéœ€ä¸éœ€è¦åˆå§‹åŒ–
æ”¹é€ å®¹å™¨ è¿™é‡Œå…ˆçœ‹ä¸€ä¸ªåˆ«äººå®¶çš„ vectorï¼šLess
çœ‹ä¸€ä¸‹æŸä¸ªä»£ç ç‰‡æ®µ
struct default_init_t {}; inline constexpr default_init_t default_init; struct with_capacity_t {}; inline constexpr with_capacity_t with_capacity; vector(default_init_t, size_type const size) { this-&gt;construct(size, size, [](auto p, auto) { new (p, placement_tag) T; }); } vector(size_type size) { this-&gt;construct(size, size, [](auto p, auto) { new (p, placement_tag) T(); }); } vector(with_capacity_t, size_type const capacity) { this-&gt;construct(0u, capacity, [](auto, auto) {}); } vector(size_type size, T const&amp; value) { this-&gt;construct(size, size, [&amp;](auto p, auto) { new (p, placement_tag) T(value); }); } æ€è€ƒğŸ¤”ï¼Œç›´æ¥æŠŠä¸€ä¸ªç»“æ„ä½“ç±»å‹ä½œä¸ºå‚æ•°ï¼Ÿç®—äº†ç›´æ¥å» c&#43;&#43; ç¾¤é—®ä¸€ä¸‹">  

  <title>
    
      C&#43;&#43; èƒ¡è¨€ä¹±è¯­X1
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/" />
  
  
  
  <link rel="stylesheet" href="/css/main.c5af9bae99b4a3d315b9f39305ffff27e9c3383fbbfd8b5fcaf2237667021a333a982fb958d1813a720b0a660b14022337553ae1ca93ef2ee17c4ae628ac19cb.css" integrity="sha512-xa&#43;brpm0o9MVufOTBf//J&#43;nDOD&#43;7/YtfyvIjdmcCGjM6mC&#43;5WNGBOnILCmYLFAIjN1U64cqT7y7hfErmKKwZyw==" />
  
</head>
<body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">back</a>


<article>
    <p class="post-meta">
        <time datetime="2022-09-19 00:00:00 &#43;0000 UTC">
            2022-09-19
        </time>
    </p>

    <h1>C&#43;&#43; èƒ¡è¨€ä¹±è¯­X1</h1>

    

    <h2 id="æŸäº›-stl-å®¹å™¨">æŸäº› STL å®¹å™¨</h2>
<p>åœ¨åˆ· leetcodeï¼Œå…¶ä¸­æŸé“é¢˜ä¸­çš„ä»£ç ç‰‡æ®µæ˜¯è¿™æ ·çš„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span>string res;
</span></span><span style="display:flex;"><span>res.resize(size - i);
</span></span><span style="display:flex;"><span><span style="color:#0f0">// res.reserve(size - i);
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>
</span></span><span style="display:flex;"><span><span style="color:#f00">for</span> (<span style="color:#ee82ee">int</span> j = <span style="color:#f60">0</span>; i &lt; size; i += <span style="color:#f60">1</span>, j += <span style="color:#f60">1</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    res[j] = arr[i] + <span style="color:#87ceeb">&#39;0&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#0f0">// res.push_back(arr[i] + &#39;0&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>}
</span></span></code></pre></div><p>æ²¡æ³¨é‡Šçš„ä»£ç æ¯”æ³¨é‡Šçš„å¿«äº†å‡ msï¼ŒåŸå› å¦‚ä¸‹</p>
<p>å› ä¸ºå®¹å™¨ä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼Œä¸éœ€è¦è€ƒè™‘æ‹·è´åŸæ¥çš„å…ƒç´ </p>
<ol>
<li>resize é‡æ–°åˆ†é…å†…å­˜å¹¶ä¸”é»˜è®¤åˆå§‹åŒ–ï¼Œsize æ”¹å˜ï¼ˆå¤§æ¦‚å¼€é”€ malloc + memsetï¼‰</li>
<li>reserve é‡æ–°åˆ†é…äº†å†…å­˜ï¼Œä¸åˆå§‹åŒ–ï¼Œsize ä¸å˜</li>
<li>push_back éœ€è¦æ£€æŸ¥ size æœ‰æ²¡æœ‰å¤§äº capacityï¼Œå¤šäº†åˆ†æ”¯çš„å¼€é”€</li>
</ol>
<p>ç„¶è€Œè¿™é‡Œä»£ç ä¹Ÿä¸æ˜¯æœ€å¿«çš„ï¼Œæ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡Œ resize è¿˜å¤šäº†ä¸€ä¸ª memset çš„å¼€é”€ï¼Œæ‰€ä»¥æœ€ä¼˜è§£åº”è¯¥æ˜¯ï¼Œç”¨è‡ªå·±å†™çš„ vectorï¼ˆé€ƒ</p>
<p>ä¸çŸ¥é“æ˜¯å†å²åŸå› è¿˜æ˜¯æ ‡å‡†å§”å‘˜ä¼šæ ¹æœ¬æ²¡è€ƒè™‘åˆ°ï¼Œåº”è¯¥åŠ å¤šå‡ ä¸ªå‡½æ•°æ¥è¡¨ç¤ºéœ€ä¸éœ€è¦åˆå§‹åŒ–</p>
<h2 id="æ”¹é€ å®¹å™¨">æ”¹é€ å®¹å™¨</h2>
<p>è¿™é‡Œå…ˆçœ‹ä¸€ä¸ªåˆ«äººå®¶çš„ vectorï¼š<a href="https://github.com/cmazakas/less/">Less</a></p>
<p>çœ‹ä¸€ä¸‹æŸä¸ªä»£ç ç‰‡æ®µ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#f00">struct</span> default_init_t {};
</span></span><span style="display:flex;"><span><span style="color:#f00">inline</span> <span style="color:#f00">constexpr</span> default_init_t default_init;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">struct</span> with_capacity_t {};
</span></span><span style="display:flex;"><span><span style="color:#f00">inline</span> <span style="color:#f00">constexpr</span> with_capacity_t with_capacity;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vector(default_init_t, size_type <span style="color:#f00">const</span> size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f00">this</span>-&gt;construct(size, size, [](<span style="color:#f00">auto</span> p, <span style="color:#f00">auto</span>) { <span style="color:#f00">new</span> (p, placement_tag) T; });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vector(size_type size)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f00">this</span>-&gt;construct(size, size,
</span></span><span style="display:flex;"><span>                 [](<span style="color:#f00">auto</span> p, <span style="color:#f00">auto</span>) { <span style="color:#f00">new</span> (p, placement_tag) T(); });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vector(with_capacity_t, size_type <span style="color:#f00">const</span> capacity)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f00">this</span>-&gt;construct(<span style="color:#f60">0u</span>, capacity, [](<span style="color:#f00">auto</span>, <span style="color:#f00">auto</span>) {});
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vector(size_type size, T <span style="color:#f00">const</span>&amp; value)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span> <span style="color:#f00">this</span>-&gt;construct(size, size,
</span></span><span style="display:flex;"><span>                 [&amp;](<span style="color:#f00">auto</span> p, <span style="color:#f00">auto</span>) { <span style="color:#f00">new</span> (p, placement_tag) T(value); });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ€è€ƒğŸ¤”ï¼Œç›´æ¥æŠŠä¸€ä¸ªç»“æ„ä½“ç±»å‹ä½œä¸ºå‚æ•°ï¼Ÿç®—äº†ç›´æ¥å» c++ ç¾¤é—®ä¸€ä¸‹</p>
<p>å“¦ï¼ŒåŸæ¥è¿™ä¸ªå«<code>tag dispatch</code>ï¼Œæ‰å‘ç°è¿™è¯­æ³•åœ¨ï¼ˆMSVC STLï¼‰åˆ°å¤„éƒ½æ˜¯ï¼Œæ„Ÿè§‰ä¸å¦‚å¤šå†™ä¸ª make ç³»åˆ—å‡½æ•°ï¼Œè€Œä¸æ˜¯é‡è½½æ„é€ å‡½æ•°</p>
<p>æˆ‘è§‰å¾—æ›´å¥½çš„å®è·µåº”è¯¥æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-C++" data-lang="C++"><span style="display:flex;"><span><span style="color:#0f0">// åˆ†é…å†…å­˜ï¼Œsize æ”¹å˜ï¼Œé»˜è®¤åˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#f00">static</span> vector&lt;T&gt; make_default_init(std::size_t size, <span style="color:#f00">const</span> T&amp; val = T{});
</span></span><span style="display:flex;"><span><span style="color:#0f0">// åˆ†é…å†…å­˜ï¼Œsize æ”¹å˜ï¼Œä¸è¿›è¡Œåˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#f00">static</span> vector&lt;T&gt; make_default_without_init(std::size_t size);
</span></span><span style="display:flex;"><span><span style="color:#0f0">// åˆ†é…å†…å­˜ï¼Œsize ä¸å˜ï¼Œä¸è¿›è¡Œåˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#f00">static</span> vector&lt;T&gt; make_with_capacity(std::size_t size);
</span></span><span style="display:flex;"><span><span style="color:#0f0">// é‡æ–°åˆ†é…å†…å­˜ï¼Œsize æ”¹å˜ï¼Œä¸è¿›è¡Œåˆå§‹åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#ee82ee">void</span> <span style="color:#ff0">resize_without_init</span>(std::size_t size);
</span></span></code></pre></div><hr>
<p>è¿™ä¸ªåº“è¿˜æœ‰ä¸ªè®¾è®¡æ˜¯ï¼ŒæŠ›å¼ƒ std::allocatorï¼Œä½¿ç”¨è‡ªå®šä¹‰ new å’Œ delete</p>
<p>std::allocator è¿™ç©æ„è®¾è®¡æœ‰è¯¯ï¼Œæ‰”æ‰å¾ˆæ­£å¸¸ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œçœ‹<a href="https://www.zhihu.com/question/50997867/answer/2212678027">è¿™ä¸ª</a></p>
<h2 id="è‡ªå¢è¿ç®—ç¬¦">è‡ªå¢è¿ç®—ç¬¦</h2>
<p>åœ¨æœ€ä¸Šé¢çš„ä»£ç ï¼Œé‡Œé¢è‡ªå¢1éƒ½æ˜¯ä½¿ç”¨<code>+=</code>ï¼Œè¿™æ˜¯å¥½çš„ä»£ç é£æ ¼</p>
<p>æœ‰æ—¶å€™ä½ ä¼šçœ‹è§è¿™ç§ä»£ç ï¼š<code>++array[index++]</code></p>
<p>å‰ç¼€/åç¼€è‡ªå¢è¿ç®—ç¬¦èµ¶ç´§æ­»ä¸€æ­»ï¼Œåå‡ºä¸–çš„è¯­è¨€åŸºæœ¬éƒ½æ²¡æœ‰<code>++</code>è¿™ä¸ªè¯­æ³•äº†</p>
<p>æ›´è®©æˆ‘è§‰å¾—æ¶å¿ƒçš„æ˜¯ï¼Œç¾¤å‹åœ¨ AMD çš„ç¬”è¯•è¯´è€ƒ<code>i+++++i</code>è¿™ç§é¢˜ï¼Œå°±ç®—æ˜¯å¤–ä¼æˆ‘ä¹Ÿæƒ³å¼€å–·ï¼šä¸­å›½æœ¬åœŸåŒ–äº†è¿™æ˜¯ï¼ŒçœŸæ¥â€œè°­æ•™æˆâ€çš„åœ°æ°”å•Š</p>
<p>åˆ«è¯´èƒ½è€ƒä½  ä½“ç³»ç»“æ„/æ“ä½œç³»ç»Ÿ/ç¼–è¯‘å™¨ çš„çŸ¥è¯†ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªå¤§å‰æå°±æ˜¯ï¼Œ<a href="https://en.cppreference.com/w/cpp/language/ub">ub</a> ä¸èƒ½æ‹¿æ¥åšé¢˜ç›®</p>

</article>

            </div>
        </main>
    </body>
</html>
