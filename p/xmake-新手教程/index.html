<!DOCTYPE html>
<html lang="zh-cn">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='构建系统的文档好像都有一个老毛病，就是不太适合新手去阅读（官方教程过于简短）。一些人认为文档写得很混乱，cmake/xmake/meson 都是如此，因此有了这个教程。
新手，是指了解 c/c&#43;&#43; 基础的编译链接，并不是对计算机科学（用过至少一门编程语言）一无所知的萌新。
这里还有两份教程可以互相参考。
A Tour of xmake 一份非官方的xmake教程 xmake从入门到精通1：安装和更新 如果想看类似于 meson 的 How do I do X in Meson? 和 Frequently Asked Questions，请看另一篇文章： Xmake 常见问题解答。
xmake 的官方交流群，可以查看文档自行添加。
安装 这部分文档写得很清楚，在各自的平台用对应的包管理安装即可，另外使用 Windows 系统的读者需要注意两点：
自行下载压缩包然后解压到某个目录，确保该目录没有其他东西。 曾有人解压到了软件目录，里面有其他软件，然后卸载 xmake 的时候，把其他软件也删了。
想通过源码的方式编译安装，需要提前装好一个 xmake，因为 xmake 源码由 c &#43; lua 组成，c 源码需要 xmake 自己编译，也就是&amp;quot;自举&amp;quot;。 打开命令行，输入xmake --version验证一下是否正确安装。
Hello world 这里先介绍怎么编译一个 hello world 工程。
打开命令行，输入xmake create hello，用 xmake 生成自带的 hello world 模板。
$ xmake create hello create hello .'><title>Xmake 新手教程</title>

<link rel='canonical' href='https://star-hengxing.github.io/p/xmake-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B/'>

<link rel="stylesheet" href="/scss/style.min.690a283bac9f967161eea605d3ab2ebc0b689da41a8b82c681a9dd82668ccf94.css"><meta property='og:title' content='Xmake 新手教程'>
<meta property='og:description' content='构建系统的文档好像都有一个老毛病，就是不太适合新手去阅读（官方教程过于简短）。一些人认为文档写得很混乱，cmake/xmake/meson 都是如此，因此有了这个教程。
新手，是指了解 c/c&#43;&#43; 基础的编译链接，并不是对计算机科学（用过至少一门编程语言）一无所知的萌新。
这里还有两份教程可以互相参考。
A Tour of xmake 一份非官方的xmake教程 xmake从入门到精通1：安装和更新 如果想看类似于 meson 的 How do I do X in Meson? 和 Frequently Asked Questions，请看另一篇文章： Xmake 常见问题解答。
xmake 的官方交流群，可以查看文档自行添加。
安装 这部分文档写得很清楚，在各自的平台用对应的包管理安装即可，另外使用 Windows 系统的读者需要注意两点：
自行下载压缩包然后解压到某个目录，确保该目录没有其他东西。 曾有人解压到了软件目录，里面有其他软件，然后卸载 xmake 的时候，把其他软件也删了。
想通过源码的方式编译安装，需要提前装好一个 xmake，因为 xmake 源码由 c &#43; lua 组成，c 源码需要 xmake 自己编译，也就是&amp;quot;自举&amp;quot;。 打开命令行，输入xmake --version验证一下是否正确安装。
Hello world 这里先介绍怎么编译一个 hello world 工程。
打开命令行，输入xmake create hello，用 xmake 生成自带的 hello world 模板。
$ xmake create hello create hello .'>
<meta property='og:url' content='https://star-hengxing.github.io/p/xmake-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B/'>
<meta property='og:site_name' content='恒星的小站'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='C&#43;&#43;' /><meta property='article:tag' content='Xmake' /><meta property='article:published_time' content='2023-06-30T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2023-08-21T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Xmake 新手教程">
<meta name="twitter:description" content="构建系统的文档好像都有一个老毛病，就是不太适合新手去阅读（官方教程过于简短）。一些人认为文档写得很混乱，cmake/xmake/meson 都是如此，因此有了这个教程。
新手，是指了解 c/c&#43;&#43; 基础的编译链接，并不是对计算机科学（用过至少一门编程语言）一无所知的萌新。
这里还有两份教程可以互相参考。
A Tour of xmake 一份非官方的xmake教程 xmake从入门到精通1：安装和更新 如果想看类似于 meson 的 How do I do X in Meson? 和 Frequently Asked Questions，请看另一篇文章： Xmake 常见问题解答。
xmake 的官方交流群，可以查看文档自行添加。
安装 这部分文档写得很清楚，在各自的平台用对应的包管理安装即可，另外使用 Windows 系统的读者需要注意两点：
自行下载压缩包然后解压到某个目录，确保该目录没有其他东西。 曾有人解压到了软件目录，里面有其他软件，然后卸载 xmake 的时候，把其他软件也删了。
想通过源码的方式编译安装，需要提前装好一个 xmake，因为 xmake 源码由 c &#43; lua 组成，c 源码需要 xmake 自己编译，也就是&amp;quot;自举&amp;quot;。 打开命令行，输入xmake --version验证一下是否正确安装。
Hello world 这里先介绍怎么编译一个 hello world 工程。
打开命令行，输入xmake create hello，用 xmake 生成自带的 hello world 模板。
$ xmake create hello create hello .">
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>返回</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/xmake-%E6%96%B0%E6%89%8B%E6%95%99%E7%A8%8B/">Xmake 新手教程</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 30, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 9 分钟
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    
    
    <p>构建系统的文档好像都有一个老毛病，就是不太适合新手去阅读（官方教程过于简短）。一些人认为文档写得很混乱，cmake/xmake/meson 都是如此，因此有了这个教程。</p>
<blockquote>
<p>新手，是指了解 c/c++ 基础的编译链接，并不是对计算机科学（用过至少一门编程语言）一无所知的萌新。</p>
</blockquote>
<p>这里还有两份教程可以互相参考。</p>
<ul>
<li><a class="link" href="https://www.zhihu.com/column/c_1537535487199281152"  target="_blank" rel="noopener"
    >A Tour of xmake 一份非官方的xmake教程</a></li>
<li><a class="link" href="https://tboox.org/cn/2019/11/09/quickstart-1-installation"  target="_blank" rel="noopener"
    >xmake从入门到精通1：安装和更新</a></li>
</ul>
<p>如果想看类似于 meson 的 <a class="link" href="https://mesonbuild.com/howtox.html"  target="_blank" rel="noopener"
    >How do I do X in Meson?</a> 和 <a class="link" href="https://mesonbuild.com/FAQ.html"  target="_blank" rel="noopener"
    >Frequently Asked Questions</a>，请看另一篇文章： <a class="link" href="https://zhuanlan.zhihu.com/p/611388172"  target="_blank" rel="noopener"
    >Xmake 常见问题解答</a>。</p>
<p>xmake 的官方交流群，可以查看<a class="link" href="https://xmake.io/#/zh-cn/about/contact"  target="_blank" rel="noopener"
    >文档</a>自行添加。</p>
<h2 id="安装">安装</h2>
<p>这部分<a class="link" href="https://xmake.io/#/zh-cn/guide/installation"  target="_blank" rel="noopener"
    >文档</a>写得很清楚，在各自的平台用对应的包管理安装即可，另外使用 Windows 系统的读者需要注意两点：</p>
<ul>
<li>自行下载压缩包然后解压到某个目录，确保该目录没有其他东西。</li>
</ul>
<blockquote>
<p>曾有人解压到了软件目录，里面有其他软件，然后卸载 xmake 的时候，把其他软件也删了。</p>
</blockquote>
<ul>
<li>想通过源码的方式编译安装，需要提前装好一个 xmake，因为 xmake 源码由 c + lua 组成，c 源码需要 xmake 自己编译，也就是&quot;自举&quot;。</li>
</ul>
<p>打开命令行，输入<code>xmake --version</code>验证一下是否正确安装。</p>
<h2 id="hello-world">Hello world</h2>
<p>这里先介绍怎么编译一个 hello world 工程。</p>
<p>打开命令行，输入<code>xmake create hello</code>，用 xmake 生成自带的 hello world 模板。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ xmake create hello
</span></span><span style="display:flex;"><span>create hello ...
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span>: src/main.cpp
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span>: xmake.lua
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span>: .gitignore
</span></span><span style="display:flex;"><span>create ok!
</span></span></code></pre></div><p>假如你已经安装好了 c/c++ 编译器（msvc/gcc/clang），我们可以直接编译运行，并看到打印出了 hello world。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ <span style="color:#8be9fd;font-style:italic">cd</span> hello
</span></span><span style="display:flex;"><span>$ xmake
</span></span><span style="display:flex;"><span>$ xmake run
</span></span><span style="display:flex;"><span>hello world!
</span></span></code></pre></div><blockquote>
<p>在 Windows 上，请不要在 git 自带的终端上执行 xmake 命令，可以选择使用 cmd 或 powershell，或者在执行 xmake 命令前，先指定目标平台：<code>xmake f -p windows</code>。</p>
</blockquote>
<p>在 Linux 上，xmake 默认编译器是 gcc ，Windows 则是 msvc。clang 在两个平台都可以使用，我们可以在命令行切换工具链进行编译。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ xmake f --toolchain<span style="color:#ff79c6">=</span>clang
</span></span><span style="display:flex;"><span>$ xmake
</span></span><span style="display:flex;"><span>$ xmake run
</span></span><span style="display:flex;"><span>hello world!
</span></span></code></pre></div><h2 id="编码">编码</h2>
<p>现在最基本的编译已经完成了，但我们怎么写代码呢？这里介绍几个常用的文本编辑器。</p>
<h3 id="visual-studio">Visual Studio</h3>
<p>下面命令会生成 sln 工程，点开后和平时使用 vs 写代码一样。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake project -k vsxmake -m <span style="color:#f1fa8c">&#34;debug,release&#34;</span>
</span></span></code></pre></div><h3 id="visual-studio-code">Visual Studio Code</h3>
<p>vscode 是 xmake 支持度最高（vscode 插件比较好开发）的编辑器，只需要安装 xmake 插件，然后挑选一个你喜欢的 intellisense 插件即可。</p>
<p>假如你使用 clangd + codelldb（clangd 是语法提示/补全工具，codelldb 是调试工具），因为 xmake 插件默认在 .vscode 目录下生成 compile_commands.json，那么只要在<code>.vscode/settings.json</code>写下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;clangd.arguments&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;--compile-commands-dir=.vscode&#34;</span>,
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;xmake.debugConfigType&#34;</span>: <span style="color:#f1fa8c">&#34;codelldb&#34;</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>这时候点开 src/main.cpp 文件，clangd 会自动运行，vscode 算是配置完成了，是不是很简单。</p>
<p>如果想用 cpptools（微软的 c++ 插件），请参考<a class="link" href="https://xmake.io/#/zh-cn/plugin/more_plugins"  target="_blank" rel="noopener"
    >文档</a></p>
<p>官方演示视频：</p>
<ul>
<li><a class="link" href="https://www.bilibili.com/video/BV1sF411E7DA"  target="_blank" rel="noopener"
    >https://www.bilibili.com/video/BV1sF411E7DA</a></li>
<li><a class="link" href="https://www.youtube.com/watch?v=yAYYuXmPXPc"  target="_blank" rel="noopener"
    >https://www.youtube.com/watch?v=yAYYuXmPXPc</a></li>
</ul>
<h3 id="clion">Clion</h3>
<p>目前来说，clion 的 xmake 插件是不可用状态，只能靠生成 cmakelists 来支持 clion。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake project -k cmakelists
</span></span></code></pre></div><h3 id="其他">其他</h3>
<p>没介绍的文本编辑器请看<a class="link" href="https://xmake.io/#/zh-cn/plugin/builtin_plugins"  target="_blank" rel="noopener"
    >文档</a>。此外，一个小众的国产 c/c++ 编辑器 <a class="link" href="https://gitee.com/scu319hy/edx"  target="_blank" rel="noopener"
    >edx</a> 也支持了 xmake，可以玩玩。</p>
<h2 id="hello-world-模板解析">Hello world 模板解析</h2>
<p>部署了开发环境，回顾一下刚刚的生成的 xmake.lua。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;mode.debug&#34;</span>, <span style="color:#f1fa8c">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;src/*.cpp&#34;</span>)
</span></span></code></pre></div><p>工程需要至少一种构建类型（build type），常见的有 debug/release，可以通过<code>xmake f -m &lt;build type&gt;</code>切换构建类型。</p>
<p><code>add_rules(&quot;mode.debug&quot;, &quot;mode.release&quot;)</code>使用了 xmake 内置的编译参数，也就是说，xmake 帮我们写好了这些代码。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#ff79c6">if</span> is_mode(<span style="color:#f1fa8c">&#34;debug&#34;</span>) <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    set_symbols(<span style="color:#f1fa8c">&#34;debug&#34;</span>)
</span></span><span style="display:flex;"><span>    set_optimize(<span style="color:#f1fa8c">&#34;none&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">elseif</span> is_mode(<span style="color:#f1fa8c">&#34;release&#34;</span>) <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    set_symbols(<span style="color:#f1fa8c">&#34;hidden&#34;</span>)
</span></span><span style="display:flex;"><span>    set_optimize(<span style="color:#f1fa8c">&#34;fastest&#34;</span>)
</span></span><span style="display:flex;"><span>    set_strip(<span style="color:#f1fa8c">&#34;all&#34;</span>)
</span></span><span style="display:flex;"><span>    add_cxflags(<span style="color:#f1fa8c">&#34;-DNDEBUG&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">end</span>
</span></span></code></pre></div><p>通过判断构建类型，设置了不同的参数。</p>
<ul>
<li>symbols -&gt; 设置生成符号信息，这样才可以调试我们的程序，hidden 表示符号不可见。</li>
<li>optimize -&gt; 优化等级（等级越高，程序运行越快），none 表示不需要优化。</li>
<li>strip -&gt; 去掉符号，all 表示链接的时候，strip 掉所有符号，包括调试符号。</li>
<li>cxflags -&gt; 给 c/c++ 添加编译选项，<code>-DNDEBUG</code>就是塞了一个<code>NDEBUG</code>宏</li>
</ul>
<p>除了构建类型，工程还需要至少一个构建目标（target），<code>target(&quot;hello&quot;)</code>代表新建一个目标，并命名为 hello。后面所有的设置，都只会对这个目标生效。目标类型可以是静态库（static），也可以是动态库（shared），当然最常见的是可执行程序（binary），对应上面的 xmake.lua 就是<code>set_kind(&quot;binary&quot;)</code>。</p>
<blockquote>
<p>除了上面这三种类型，<a class="link" href="https://xmake.io/#/zh-cn/manual/project_target?id=targetset_kind"  target="_blank" rel="noopener"
    >set_kind</a> 还支持 phony/object/headeronly 类型。</p>
</blockquote>
<p>add_files 是一个很强大的接口，这里只简单介绍，详细可以去看<a class="link" href="https://xmake.io/#/zh-cn/manual/project_target?id=targetadd_files"  target="_blank" rel="noopener"
    >文档</a>。</p>
<p><code>*</code>是通配符，可以根据文件后缀匹配一批符合要求的文件。</p>
<ul>
<li><code>*</code> -&gt; 在目录内添加文件。假如 src 目录下有 hello.cpp 和 world.cpp 文件，<code>add_files(&quot;src/*.cpp&quot;)</code>只会把 hello.cpp 和 world.cpp 添加进去。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>- src
</span></span><span style="display:flex;"><span>  - hello.cpp
</span></span><span style="display:flex;"><span>  - world.cpp
</span></span><span style="display:flex;"><span>- xmake.lua
</span></span><span style="display:flex;"><span>- main.cpp
</span></span></code></pre></div><ul>
<li><code>**</code> -&gt; 递归目录添加文件。假如 src 目录下有 hello.cpp，src 目录下还有一个 tmp 目录，里面有一个 world.cpp 文件，<code>add_files(&quot;src/**.cpp&quot;)</code>还是只会把 hello.cpp 和 world.cpp 添加进去。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>- src
</span></span><span style="display:flex;"><span>  - hello.cpp
</span></span><span style="display:flex;"><span>  - tmp
</span></span><span style="display:flex;"><span>    - world.cpp
</span></span><span style="display:flex;"><span>- xmake.lua
</span></span><span style="display:flex;"><span>- main.cpp
</span></span></code></pre></div><h2 id="命令行解析">命令行解析</h2>
<p>在上面我们用到了许多命令，比如<code>xmake f -m debug</code>，其实完整命令如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake config --mode<span style="color:#ff79c6">=</span>debug
</span></span></code></pre></div><p>一个工程需要先配置（config）后构建（build），在<strong>新</strong>工程中，直接执行<code>xmake</code>命令，代表使用<strong>默认配置</strong>直接构建。</p>
<p><code>xmake --help</code>可以输出 xmake 的命令行操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake v2.7.9+HEAD.c87922676, A cross-platform build utility based on Lua
</span></span><span style="display:flex;"><span>Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> 2015-present Ruki Wang, tboox.org, xmake.io
</span></span><span style="display:flex;"><span>                         _
</span></span><span style="display:flex;"><span>    __  ___ __  __  __ _| | ______
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">\ \/</span> / |  <span style="color:#f1fa8c">\/</span>  |/ _  | |/ / __ <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>     &gt;  &lt;  | <span style="color:#f1fa8c">\_</span>_/ | /_| |   &lt;  ___/
</span></span><span style="display:flex;"><span>    /_/<span style="color:#f1fa8c">\_\_</span>|_|  |_|<span style="color:#f1fa8c">\_</span>_ <span style="color:#f1fa8c">\|</span>_|<span style="color:#f1fa8c">\_\_</span>___|
</span></span><span style="display:flex;"><span>                         by ruki, xmake.io
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    👉  Manual: https://xmake.io/#/getting_started
</span></span><span style="display:flex;"><span>    🙏  Donate: https://xmake.io/#/sponsor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage: <span style="color:#8be9fd;font-style:italic">$xmake</span> <span style="color:#ff79c6">[</span>task<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>options<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>target<span style="color:#ff79c6">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Build targets <span style="color:#ff79c6">if</span> no given tasks.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Actions:
</span></span><span style="display:flex;"><span>    b, build             Build targets <span style="color:#ff79c6">if</span> no given tasks.
</span></span><span style="display:flex;"><span>    u, uninstall         Uninstall the project binary files.
</span></span><span style="display:flex;"><span>    i, install           Package and install the target binary files.
</span></span><span style="display:flex;"><span>    q, require           Install and update required packages.
</span></span><span style="display:flex;"><span>    p, package           Package target.
</span></span><span style="display:flex;"><span>    c, clean             Remove all binary and temporary files.
</span></span><span style="display:flex;"><span>    f, config            Configure the project.
</span></span><span style="display:flex;"><span>       service           Start service <span style="color:#ff79c6">for</span> remote or distributed compilation and etc.
</span></span><span style="display:flex;"><span>       update            Update and uninstall the xmake program.
</span></span><span style="display:flex;"><span>    r, run               Run the project target.
</span></span><span style="display:flex;"><span>       create            Create a new project.
</span></span><span style="display:flex;"><span>    g, global            Configure the global options <span style="color:#ff79c6">for</span> xmake.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>在 Actions 中，最常用的是<code>config/build/run</code>。输入<code>xmake config --help</code>，则会打印子选项更多操作。</p>
<blockquote>
<p>本文大多数命令使用简写。</p>
</blockquote>
<h3 id="通用操作">通用操作</h3>
<ul>
<li><code>-h|--help</code> -&gt; 帮助信息。</li>
<li><code>-v|--verbose</code> -&gt; 输出更多的信息。在构建时使用这个命令，可以看到 xmake 调用编译器的每一步。</li>
<li><code>-D|--diagnosis</code> -&gt; 通常用于调试 xmake 本身。</li>
</ul>
<blockquote>
<p>这些简写通常可以合并在一起操作，比如<code>xmake -vD</code>。</p>
</blockquote>
<h3 id="action-常用操作">action 常用操作</h3>
<ul>
<li><code>xmake f -c</code> -&gt; 清除当前 xmake 工程的缓存。当你遇到了无法解决的问题，可以先来一发这个命令。</li>
<li><code>xmake f -p mingw</code> -&gt; 指定构建目标平台。在 Windows 系统上默认平台是 <code>windows</code>，想要在 mingw/msys2 平台编译，需要手动切换。</li>
<li><code>xmake f -P ../projectdir -o ../build</code> -&gt; 把工作目录和构建目录放在其他地方。保持源码目录整洁，适合洁癖。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>- build <span style="color:#ff79c6">(</span>generated<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>- workdir
</span></span><span style="display:flex;"><span>  - .xmake <span style="color:#ff79c6">(</span>generated<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>- projectdir
</span></span><span style="display:flex;"><span>  - src 
</span></span><span style="display:flex;"><span>  - xmake.lua
</span></span></code></pre></div><ul>
<li><code>xmake build -r</code> -&gt; 重新编译整个工程，<code>xmake build -r target</code>则是重新编译指定 target。</li>
<li><code>xmake build -j4</code> -&gt; xmake 默认多线程（根据 cpu 核心数）编译跑满 CPU 所有核心，<code>-j4</code>调整并行编译任务数，。</li>
</ul>
<blockquote>
<p>当工程 config 后，<code>xmake -r</code>和<code>xmake -j4</code>和上面是完全等价的。</p>
</blockquote>
<ul>
<li><code>xmake run -d target</code> -&gt; 启动调试器调试指定 target。</li>
</ul>
<h2 id="包管理">包管理</h2>
<p>xmake 的包管理十分强大，除了自动下载依赖库源码编译安装，还可以使用其他包管理的库。</p>
<p>包可以分类为系统库和非系统库，系统库是最稳定的，但基本是版本固定的预编译二进制，不太灵活。而非系统库直接拉取源码编译，可以最大化自定义操作（比如调整编译参数、只启用包的某个组件等）。</p>
<h3 id="使用">使用</h3>
<p>修改一下 hello world 模板。这里使用了一个比较知名的库（已经加入了 c++20 标准库）。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;mode.debug&#34;</span>, <span style="color:#f1fa8c">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;src/*.cpp&#34;</span>)
</span></span><span style="display:flex;"><span>    add_packages(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span></code></pre></div><p>引入 fmt 库就这么简单，只需要<code>add_requires</code>和<code>add_packages</code>。然后执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake f -y
</span></span><span style="display:flex;"><span>xmake
</span></span></code></pre></div><blockquote>
<p>如果不使用<code>-y</code>，那么下载依赖的时候需要手动确认。</p>
</blockquote>
<p>依赖下载在 config 阶段，只有正确编译测试包才算成功安装。如果想知道下载编译安装的全过程，可以使用<code>xmake f -vD</code>。</p>
<blockquote>
<p>由于不可描述原因，源码可能会下载失败，请根据<a class="link" href="https://xmake.io/#/zh-cn/package/remote_package?id=%e8%ae%be%e7%bd%ae%e4%bb%a3%e7%90%86"  target="_blank" rel="noopener"
    >文档</a>为 xmake 挂上代理。</p>
</blockquote>
<h3 id="系统库">系统库</h3>
<p>系统库通常都是从系统官方包管理（apt/pacman/homebrew）下载的包。默认情况下 xmake 会先去找系统库，如果没有才下载远程包，基本上只有在非 Windows 平台才需要考虑是否使用系统库，我们也可以通过<code>add_requires</code>传入参数强制 xmake 使用系统库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;zlib&#34;</span>, {system <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>})
</span></span></code></pre></div><p>我们也可以直接指定想用的系统包。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;brew::zlib&#34;</span>, {alias <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;zlib&#34;</span>})
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;pacman::zlib&#34;</span>, {alias <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;zlib&#34;</span>})
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;pkgconfig::zlib&#34;</span>, {alias <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;zlib&#34;</span>})
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 第三方包管理</span>
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;vcpkg::zlib&#34;</span>, {alias <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;zlib&#34;</span>})
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;conan::zlib&#34;</span>, {alias <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;zlib&#34;</span>})
</span></span></code></pre></div><blockquote>
<p>设置了 alias，我们只需要<code>add_packages(&quot;zlib&quot;)</code>而不是<code>add_packages(&quot;brew::zlib&quot;)</code>。</p>
</blockquote>
<p>在 Windows 平台，有些库需要使用它的预编译二进制进行开发，如 cuda/vulkansdk/qt。执行<code>xmake f -h</code>，可以看到 qt 和 cuda 是可配置选项，可以直接用<code>xmake f --qt=</code>或者<code>xmake f --cuda=</code>指定 sdk 目录。</p>
<p>但选项中没有 vulkansdk，因为 cuda/qt 是 c++ 大生态的一部分，xmake 内部都对此做了支持。这种情况下，执行<code>xrepo search vulkansdk</code>查找包。如果搜索结果显示有这个包，那就和上面引入 fmt 库操作一样。</p>
<blockquote>
<p><code>xrepo search &lt;package&gt;</code> 基于包名和包描述模糊搜索，如果想用的包搜不到，大概率是 xmake 官方还没有支持这个库，可以尝试提 pull request 贡献或者 feature request 的 issue。</p>
</blockquote>
<p>如果显示安装<code>vulkansdk</code>失败，可以去提 issue 或者自行排除错误。因为 Windows 平台上的系统包通常都是基于环境变量和注册表来查找 sdk 目录，然后提取头文件和库目录。这些环境变量和注册表时在官方安装器安装时设置的，如果下载的是便携版（压缩包解压开箱即用），那么需要自己去设置环境变量等操作。</p>
<blockquote>
<p>xrepo 是 xmake 包管理的名字，类似于 meson 的 wrap。如果你查看 xrepo 的脚本，发现实质上还是调用 xmake。</p>
</blockquote>
<h3 id="非系统库远程依赖">非系统库（远程依赖）</h3>
<p><a class="link" href="https://github.com/xmake-io/xmake-repo"  target="_blank" rel="noopener"
    >xmake-repo</a> 是 xmake 的官方包管理仓库，上面存放的是各种包的编译脚本。</p>
<ul>
<li>大多数包是从 github 上下载，其他包管理也是这么做。</li>
<li>大多数包都是下载源码<strong>本地</strong>编译安装，小部分是下载预编译二进制。如果在 config 阶段卡住了，那基本上都是卡在编译阶段。</li>
<li>需要编译的包，大多数是用库自己的构建系统（cmake/meson/makefile）来进行构建，然后把 bin/lib/include 安装到 xmake 指定的位置，这像是包了一层胶水。如果库构建失败，xmake-repo 的打包者则会尝试使用 xmake 来构建此库。</li>
<li>包的存放路径可以执行<code>xmake show</code>查看<code>packagedir</code>，基本上都是按这种规范存放：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- f
</span></span><span style="display:flex;"><span>  - fmt
</span></span><span style="display:flex;"><span>    - version
</span></span><span style="display:flex;"><span>      - hash
</span></span><span style="display:flex;"><span>        - bin -&gt; .dll/.exe
</span></span><span style="display:flex;"><span>        - lib -&gt; .lib/.a
</span></span><span style="display:flex;"><span>        - include -&gt; .h/.hpp
</span></span></code></pre></div><ul>
<li>可以通过改变 xmake 的<a class="link" href="https://xmake.io/#/zh-cn/guide/configuration?id=%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f"  target="_blank" rel="noopener"
    >环境变量</a>来切换包的存放路径。</li>
</ul>
<p>xmake 支持改变包的编译配置。比如包默认是静态库，我们可以传入 configs 使其编译成动态库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;zlib&#34;</span>, {configs <span style="color:#ff79c6">=</span> {shared <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>}})
</span></span></code></pre></div><p>我们还可以传入 debug/pic/lto/vs_runtime 等 configs，这些都是 xmake <strong>内置</strong>的 configs。</p>
<p>而在 c/c++ 生态中，每个包都会有自己的编译选项。fmt 是一个头文件库，他支持<strong>非头文件</strong>的方式编译，那么可以传入对应 configs 来编译成动态库。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>, {configs <span style="color:#ff79c6">=</span> {header_only <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>, shared <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>}})
</span></span></code></pre></div><p>正因为包可以用不同 configs 来编译，所以 xmake 会对这些 configs 生成唯一 hash，这也是为什么同一个包同一个版本，还会有多个编译产物。</p>
<p>想了解对应包更多的 configs 选项，执行<code>xrepo info &lt;package&gt;</code>。</p>
<h3 id="其他-1">其他</h3>
<p>xmake 的包管理还有许多功能，比如指定包的<a class="link" href="https://xmake.io/#/zh-cn/package/remote_package?id=%e8%af%ad%e4%b9%89%e7%89%88%e6%9c%ac%e8%ae%be%e7%bd%ae"  target="_blank" rel="noopener"
    >不同版本</a>，版本可以精确到 git tag/branch/commit，还有适合内部开发的<a class="link" href="https://xmake.io/#/zh-cn/package/remote_package?id=%e4%bd%bf%e7%94%a8%e8%87%aa%e5%bb%ba%e7%a7%81%e6%9c%89%e5%8c%85%e4%bb%93%e5%ba%93"  target="_blank" rel="noopener"
    >自建包仓库</a>，更多功能可以看这篇文章：<a class="link" href="https://zhuanlan.zhihu.com/p/479977993"  target="_blank" rel="noopener"
    >Xmake 和 C/C++ 包管理</a>。</p>
<h2 id="编写-xmakelua">编写 xmake.lua</h2>
<p>在介绍完一些基础的操作后，本文开始讲解各种基础用法。</p>
<h3 id="规范">规范</h3>
<p>xmake.lua 基于 lua 编程语言，所有语句必须符合 lua 的语法。</p>
<p>正如其他构建系统一样，文档上各种 api 其实就是 xmake 自定义的 dsl(Domain-specific language)，方便用户使用。虽然有很多人讨厌 lua，但实际上，我们有 80% 的时间在使用 xmake 的 dsl 写描述文件，20% 的时间才可能用到 lua 进行编程。</p>
<p>如果有 xmake 的 dsl 不能完成的操作，我们完全可以退化到用 lua 来完成，对比使用其他构建系统的 dsl 进行编程，lua 写起来不至于那么讨厌了。</p>
<p>xmake 的 api 基于官方指定的<a class="link" href="https://xmake.io/#/zh-cn/manual/specification"  target="_blank" rel="noopener"
    >命名规范</a>，非常容易理解，比如接口末尾有<code>s</code>代表可以传入至少两个参数。</p>
<h3 id="作用域">作用域</h3>
<p>假设我们的工程目录长这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- demo
</span></span><span style="display:flex;"><span>  - include
</span></span><span style="display:flex;"><span>    - base.hpp
</span></span><span style="display:flex;"><span>  - src
</span></span><span style="display:flex;"><span>    - base
</span></span><span style="display:flex;"><span>      - base.cpp
</span></span><span style="display:flex;"><span>    - sandbox
</span></span><span style="display:flex;"><span>      - main.cpp
</span></span><span style="display:flex;"><span>  - xmake.lua
</span></span></code></pre></div><p>编写对应的 xmake.lua。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;mode.debug&#34;</span>, <span style="color:#f1fa8c">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>add_includedirs(<span style="color:#f1fa8c">&#34;include&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;base&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;static&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;src/base/*.cpp&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;sandbox&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;src/sandbox/*.cpp&#34;</span>)
</span></span><span style="display:flex;"><span>    add_packages(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span></code></pre></div><p>相比 hello world 模板，我们使用了<code>add_includedirs</code>来添加头文件的<strong>目录</strong>，并声明了两个 target，其中一个 target 类型是静态库，另一个是可执行程序。</p>
<p>在 base.cpp 编码的时候，你会发现引用不了 fmt 头文件，上面讲过：</p>
<blockquote>
<p>声明新目标后，后面所有的设置都只会对这个目标生效。</p>
</blockquote>
<p>在这里修正一下：声明新目标后，我们就进入了该目标的描述域，所有的设置只会对这个 target 生效。</p>
<p>那在 target 之外就是全局作用域了。</p>
<p>把<code>add_packages(&quot;fmt&quot;)</code>放在<code>add_requires(&quot;fmt&quot;)</code>语句后面，也就是放到全局作用域，为所有 target 都添加了 fmt 的依赖，就能在任何 cpp 文件引用 fmt 头文件了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 在全局作用域设置</span>
</span></span><span style="display:flex;"><span>add_packages(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>add_includedirs(<span style="color:#f1fa8c">&#34;include&#34;</span>)
</span></span></code></pre></div><p><code>add_rules</code>和<code>add_includedirs</code>这些接口同理，所以所有 target 都享受到了同样的配置，都能引用 base.hpp 这个头文件。</p>
<h3 id="多级配置">多级配置</h3>
<p>修改一下工程。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- demo
</span></span><span style="display:flex;"><span>  - include
</span></span><span style="display:flex;"><span>    - base.hpp
</span></span><span style="display:flex;"><span>  - src
</span></span><span style="display:flex;"><span>    - base
</span></span><span style="display:flex;"><span>      - base.cpp
</span></span><span style="display:flex;"><span>      - xmake.lua
</span></span><span style="display:flex;"><span>    - sandbox
</span></span><span style="display:flex;"><span>      - main.cpp
</span></span><span style="display:flex;"><span>      - xmake.lua
</span></span><span style="display:flex;"><span>  - xmake.lua
</span></span></code></pre></div><p>编写对应的 xmake.lua。</p>
<ul>
<li><code>demo/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;mode.debug&#34;</span>, <span style="color:#f1fa8c">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>add_includedirs(<span style="color:#f1fa8c">&#34;include&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;src/base&#34;</span>, <span style="color:#f1fa8c">&#34;src/sandbox&#34;</span>)
</span></span></code></pre></div><ul>
<li><code>demo/src/base/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;base&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;static&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span></code></pre></div><ul>
<li><code>demo/src/sandbox/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_packages(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;sandbox&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span></code></pre></div><p>我们使用了一个新接口<code>includes</code>，这个接口可以添加 xmake 的 lua 脚本，也可以添加 xmake 的子配置文件（文件名必须为<code>xmake.lua</code>）。同时我们写了两个 xmake.lua，这样就可以模块化描述工程。因为<code>add_files</code>是基于配置文件的<strong>位置</strong>来转换文件路径，所以直接用<code>*.cpp</code>匹配当前 xmake.lua 目录内的文件。</p>
<p>在 base.cpp 编码的时候，你会发现又引用不了 fmt 头文件。这是因为<code>add_packages(&quot;fmt&quot;)</code>只配置了<code>demo/src/sandbox/xmake.lua</code>内的 target，也就是说，只是个<strong>局部配置</strong>。</p>
<p>但 base 和 sandbox 依然享受到了<code>add_rules(&quot;mode.debug&quot;, &quot;mode.release&quot;)</code>和<code>add_includedirs(&quot;include&quot;)</code>的配置，这是因为两个<strong>子配置文件</strong>继承了<strong>根配置文件</strong>的配置。</p>
<blockquote>
<p>由于作用域的限定，子配置文件只能继承了根配置文件中全局作用域里的配置。</p>
</blockquote>
<p>这类似于一颗多叉树，根节点的配置可以传播给叶节点，但叶节点的配置只能自己用或者继续向下传播，无法向上传播。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>        xmake.lua
</span></span><span style="display:flex;"><span>      /           \
</span></span><span style="display:flex;"><span>base/xmake.lua  sandbox/xmake.lua
</span></span></code></pre></div><h3 id="目标依赖">目标依赖</h3>
<p>保持工程目录，修改 xmake.lua。</p>
<ul>
<li><code>demo/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;mode.debug&#34;</span>, <span style="color:#f1fa8c">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;src/base&#34;</span>, <span style="color:#f1fa8c">&#34;src/sandbox&#34;</span>)
</span></span></code></pre></div><ul>
<li><code>demo/src/base/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;base&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;static&#34;</span>)
</span></span><span style="display:flex;"><span>    add_includedirs(<span style="color:#f1fa8c">&#34;include&#34;</span>, {public <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>})
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span></code></pre></div><ul>
<li><code>demo/src/sandbox/xmake.lua</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;sandbox&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span><span style="display:flex;"><span>    add_deps(<span style="color:#f1fa8c">&#34;base&#34;</span>)
</span></span></code></pre></div><p>我们使用<code>add_deps</code>显示指定依赖的 target，这样在构建工程会先构建 base 然后构建 sandbox。</p>
<p>注意，不同 target 内部的 c/c++ 文件还是并行编译的，即使他们有依赖关系。因为 c/c++ 编译流程为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>预处理 -&gt; 中间对象 -&gt; 链接
</span></span></code></pre></div><p>所以 target 只有在链接的时候才会有依赖关系（如果有特殊情况，target 不能参与并行编译，为该 target 设置<code>set_policy(&quot;build.across_targets_in_parallel&quot;, false)</code>）。</p>
<p>target 设置的编译链接相关的 api，还会有一个属性（private/interface/public）。</p>
<p>api <strong>默认</strong> private 属性，也就是说设置的配置仅供<strong>自己</strong>使用。interface 反过来，只能给下游<strong>依赖</strong>了自己的 target 使用。</p>
<p>而<code>public == private + interface</code>，自己和下游依赖<strong>都能用</strong>。</p>
<p>因为 base 的<code>add_includedirs</code>设置了<code>public = true</code>，所以 base 和 sandbox 内的 cpp 文件，都可以引用来自 base 的头文件 base.hpp。</p>
<h3 id="脚本域">脚本域</h3>
<p>上面讲了那么多，基本上可以应付一些小型项目了。如果有更复杂的需求，就需要到<strong>脚本域</strong>里干活（也就是说，平时都是在<strong>描述域</strong>干活）。</p>
<p>因为 xmake 的特性，描述域的代码需要被扫描多次，而脚本域的代码只会被执行一次。执行<code>xmake f -c</code>，可以看见 world 只被打印一次。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>print(<span style="color:#f1fa8c">&#34;hello&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        print(<span style="color:#f1fa8c">&#34;world&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span></code></pre></div><blockquote>
<p>print 是 xmake 最<del>强大</del>的调试手段。</p>
</blockquote>
<p>在描述域，我们使用 xmake api 添加了各种配置，但有一些 api 只能在脚本域运行，比如在脚本域获取描述域中（任何 add/set api）设置的配置和执行 <code>ls</code> 命令。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>    add_cxflags(<span style="color:#f1fa8c">&#34;-O3&#34;</span>)
</span></span><span style="display:flex;"><span>    add_defines(<span style="color:#f1fa8c">&#34;Win32&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        print(target:get(<span style="color:#f1fa8c">&#34;cxflags&#34;</span>))
</span></span><span style="display:flex;"><span>        print(target:get(<span style="color:#f1fa8c">&#34;defines&#34;</span>))
</span></span><span style="display:flex;"><span>        os.vrun(<span style="color:#f1fa8c">&#34;ls&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span></code></pre></div><p>如果在描述域使用 <code>os.vrun</code> 会直接报错，只有少部分接口（例如 <code>print</code>）才能在描述域和全局作用域使用。</p>
<p><code>on_load</code>只是编写脚本域代码的其中一处，我们还可以在下面每一步编写对应脚本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>on_load -&gt; after_load -&gt; on_config -&gt; before_build -&gt; on_build -&gt; after_build
</span></span></code></pre></div><ul>
<li>on_config 在<code>xmake config</code>执行后，<code>before_build</code>执行前的时候运行。</li>
<li>如果是 c/c++ 程序，还可以在<code>[before|on|after]_link</code>编写脚本。</li>
<li>自定义<code>on_[build|link]</code>会覆盖 xmake 内置的脚本。</li>
</ul>
<p>不同构建阶段的脚本基本上可以满足各种定制化需求。</p>
<h3 id="规则">规则</h3>
<p>规则是 xmake 最强大的工具之一，你可以做到：</p>
<ul>
<li>给不同 target 应用不同的构建参数。</li>
</ul>
<p>和<code>add_rules(&quot;mode.debug&quot;, &quot;mode.release&quot;)</code>一样定制编译参数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>rule(<span style="color:#f1fa8c">&#34;module&#34;</span>)
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> target:name() <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;main&#34;</span> <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>            target:add(<span style="color:#f1fa8c">&#34;packages&#34;</span>, <span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> is_test <span style="color:#ff79c6">=</span> target:extraconf(<span style="color:#f1fa8c">&#34;rules&#34;</span>, <span style="color:#f1fa8c">&#34;module&#34;</span>, <span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> is_test <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>            target:add(<span style="color:#f1fa8c">&#34;cxflags&#34;</span>, <span style="color:#f1fa8c">&#34;-fsanitize=address&#34;</span>)
</span></span><span style="display:flex;"><span>            target:add(<span style="color:#f1fa8c">&#34;ldflags&#34;</span>, <span style="color:#f1fa8c">&#34;-fsanitize=address&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;main&#34;</span>)
</span></span><span style="display:flex;"><span>    add_rules(<span style="color:#f1fa8c">&#34;module&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>    add_rules(<span style="color:#f1fa8c">&#34;module&#34;</span>, {test <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>})
</span></span></code></pre></div><p>我们可以通过判断 target 名字是否添加 fmt 包，也可以直接传入配置来判断是该 target 是否需要启用 asan，非常灵活。</p>
<ul>
<li>构建非 c/c++ 编译产物，比如使用 typst 生成 pdf，只需要下面几十行代码。</li>
</ul>
<p>工程目录。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- src
</span></span><span style="display:flex;"><span>  - resume-zh.typ
</span></span><span style="display:flex;"><span>- xmake.lua
</span></span></code></pre></div><p><code>xmake.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>rule(<span style="color:#f1fa8c">&#34;typst&#34;</span>)
</span></span><span style="display:flex;"><span>    set_extensions(<span style="color:#f1fa8c">&#34;.typ&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 设置输出文件目录</span>
</span></span><span style="display:flex;"><span>        target:set(<span style="color:#f1fa8c">&#34;targetdir&#34;</span>, path.join(<span style="color:#f1fa8c">&#34;build&#34;</span>, <span style="color:#f1fa8c">&#34;pdf&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    on_build_file(<span style="color:#ff79c6">function</span> (target, sourcefile, opt)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 导入模块</span>
</span></span><span style="display:flex;"><span>        import(<span style="color:#f1fa8c">&#34;lib.detect.find_tool&#34;</span>)
</span></span><span style="display:flex;"><span>        import(<span style="color:#f1fa8c">&#34;core.project.depend&#34;</span>)
</span></span><span style="display:flex;"><span>        import(<span style="color:#f1fa8c">&#34;utils.progress&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 创建输出文件目录</span>
</span></span><span style="display:flex;"><span>        os.mkdir(target:targetdir())
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 找到编译器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> typst <span style="color:#ff79c6">=</span> assert(find_tool(<span style="color:#f1fa8c">&#34;typst&#34;</span>, {version <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>}), <span style="color:#f1fa8c">&#34;typst not found&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 拼接输出文件路径</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> targetfile <span style="color:#ff79c6">=</span> path.join(target:targetdir(), path.basename(sourcefile) <span style="color:#ff79c6">..</span> <span style="color:#f1fa8c">&#34;.pdf&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 一个封装好的函数，当源文件修改就会重新构建</span>
</span></span><span style="display:flex;"><span>        depend.on_changed(<span style="color:#ff79c6">function</span> ()
</span></span><span style="display:flex;"><span>            os.vrunv(typst.program, {<span style="color:#f1fa8c">&#34;compile&#34;</span>, sourcefile, targetfile})
</span></span><span style="display:flex;"><span>            progress.show(opt.progress, <span style="color:#f1fa8c">&#34;${color.build.object}compiling %s&#34;</span>, sourcefile)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>, {files <span style="color:#ff79c6">=</span> sourcefile})
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;resume&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;object&#34;</span>)
</span></span><span style="display:flex;"><span>    add_rules(<span style="color:#f1fa8c">&#34;typst&#34;</span>)
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;src/resume-zh.typ&#34;</span>)
</span></span></code></pre></div><p>和平常一样执行<code>xmake</code>，就可以得到我们的 pdf 文件。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[ 33%]: compiling src/resume-zh.typ
</span></span><span style="display:flex;"><span>[100%]: build ok, spent 0.281s
</span></span></code></pre></div><p>如果没找到编译器，assert 会失败，需要参考<a class="link" href="https://xmake.io/#/zh-cn/manual/extension_modules?id=detectfind_tool"  target="_blank" rel="noopener"
    >文档</a>进一步学习<code>find_tool</code>的用法。</p>
<h3 id="调试">调试</h3>
<p>获取 xmake 和 xmake-repo 最新版。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake update -s dev
</span></span><span style="display:flex;"><span>xrepo update-repo
</span></span></code></pre></div><p>清理全局/工程缓存。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake g -c
</span></span><span style="display:flex;"><span>xmake f -c
</span></span></code></pre></div><p>上面是最基础的调试手段，下面介绍一些需要人工辅助的方法。</p>
<ul>
<li><code>print</code>大法。</li>
</ul>
<p><code>print</code>无论在配置文件哪里都可以使用，<code>cprint</code>还可以输出有颜色的 log。除此之外还可以使用<code>assert</code>和<code>raise</code>。</p>
<ul>
<li>输出调用各种工具操作，编译的详细参数，如果出错还会打印 xmake 的栈回溯。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake -vD
</span></span></code></pre></div><blockquote>
<p>如果要给 xmake 提 issue 报 bug，请务必使用该命令生成 log 提交上去。</p>
</blockquote>
<ul>
<li>可以显示指定 target 配置信息，可以看到各种配置来源于哪个配置文件和具体的行数。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake show -t &lt;target&gt;
</span></span></code></pre></div><ul>
<li>检查工程配置和代码。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ xmake check
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 调用 clang-tidy 检测代码</span>
</span></span><span style="display:flex;"><span>$ xmake check clang.tidy
</span></span></code></pre></div><p>因为 xmake 基本上都是依靠字符串传递各种配置，如果打错参数名（typo）就会导致<code>xmake config</code>失败。这个 xmake 插件能检测到 typo （基于 Levenshtein Distance 算法），也能检测各种通过<code>add_xxx</code>接口添加的文件/目录，是否匹配文件成功。</p>
<blockquote>
<p>xmake 还有很多有用的插件，多多尝试使用。</p>
</blockquote>
<h2 id="可能的最佳实践">可能的最佳实践</h2>
<p>一个完整的项目，目录结构可能长这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>- src
</span></span><span style="display:flex;"><span>- xmake
</span></span><span style="display:flex;"><span>  - rule
</span></span><span style="display:flex;"><span>    - module.lua
</span></span><span style="display:flex;"><span>  - option.lua
</span></span><span style="display:flex;"><span>  - package.lua
</span></span><span style="display:flex;"><span>  - xmake.lua
</span></span><span style="display:flex;"><span>- test
</span></span><span style="display:flex;"><span>  - xmake.lua
</span></span><span style="display:flex;"><span>  - test1.cpp
</span></span><span style="display:flex;"><span>  - test2.cpp
</span></span><span style="display:flex;"><span>- xmake.lua
</span></span></code></pre></div><p>对应的部分配置：</p>
<p><code>xmake.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>set_project(<span style="color:#f1fa8c">&#34;name&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_version(<span style="color:#f1fa8c">&#34;0.0.1&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_xmakever(<span style="color:#f1fa8c">&#34;2.7.9&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_warnings(<span style="color:#f1fa8c">&#34;all&#34;</span>)
</span></span><span style="display:flex;"><span>set_languages(<span style="color:#f1fa8c">&#34;c++20&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_allowedplats(<span style="color:#f1fa8c">&#34;windows&#34;</span>, <span style="color:#f1fa8c">&#34;linux&#34;</span>, <span style="color:#f1fa8c">&#34;macosx&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;test&#34;</span>, <span style="color:#f1fa8c">&#34;src&#34;</span>, <span style="color:#f1fa8c">&#34;xmake&#34;</span>)
</span></span></code></pre></div><p><code>xmake/xmake.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;option.lua&#34;</span>)
</span></span><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;package.lua&#34;</span>)
</span></span><span style="display:flex;"><span>includes(<span style="color:#f1fa8c">&#34;rule/module.lua&#34;</span>)
</span></span></code></pre></div><p><code>xmake/option.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>option(<span style="color:#f1fa8c">&#34;test&#34;</span>, {default <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>, showmenu <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>, description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Enable test&#34;</span>})
</span></span><span style="display:flex;"><span>option(<span style="color:#f1fa8c">&#34;feature&#34;</span>, {default <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>, showmenu <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>, description <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Enable feature&#34;</span>})
</span></span></code></pre></div><p>可以把构建选项集中在一起（选项在<code>xmake config</code>的时候传递<code>--test=[y/n]</code>启用或关闭）。</p>
<p><code>xmake/package.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_requires(<span style="color:#f1fa8c">&#34;fmt&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> has_config(<span style="color:#f1fa8c">&#34;test&#34;</span>) <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    add_requires(<span style="color:#f1fa8c">&#34;gtest&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">end</span>
</span></span></code></pre></div><p>gtest 库只有在 test 选项启用后才会安装。</p>
<h3 id="单元测试">单元测试</h3>
<p>xmake 官方不支持单元测试，<a class="link" href="https://github.com/xmake-io/xmake/issues/3381"  target="_blank" rel="noopener"
    >相关讨论</a>。</p>
<p>可以参考下面这个单元测试模板。</p>
<p><code>xmake/rule/module.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>rule(<span style="color:#f1fa8c">&#34;module.test&#34;</span>)
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 没有开启 test 选项，就关闭 target</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> has_config(<span style="color:#f1fa8c">&#34;test&#34;</span>) <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>            target:set(<span style="color:#f1fa8c">&#34;enabled&#34;</span>, <span style="color:#ff79c6">false</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 运行目录修改为根目录</span>
</span></span><span style="display:flex;"><span>        target:set(<span style="color:#f1fa8c">&#34;rundir&#34;</span>, os.projectdir())
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 添加测试组</span>
</span></span><span style="display:flex;"><span>        target:set(<span style="color:#f1fa8c">&#34;group&#34;</span>, <span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 选择你想要的单元测试库</span>
</span></span><span style="display:flex;"><span>        target:add(<span style="color:#f1fa8c">&#34;packages&#34;</span>, <span style="color:#f1fa8c">&#34;gtest&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span></code></pre></div><p><code>test/xmake.lua</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;module.test&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 假设 test 目录下每个 cpp 文件都有自己的 main 函数</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> _, file <span style="color:#ff79c6">in</span> ipairs(os.files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)) <span style="color:#ff79c6">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">local</span> name <span style="color:#ff79c6">=</span> path.basename(file)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    target(<span style="color:#f1fa8c">&#34;test.&#34;</span> <span style="color:#ff79c6">..</span> name)
</span></span><span style="display:flex;"><span>        set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>        add_files(file)
</span></span><span style="display:flex;"><span>    target_end()
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">end</span>
</span></span></code></pre></div><p>首先写了一个名叫<code>module.test</code>的 rule，这是给测试 target 添加编译参数。然后使用<code>os.files</code>收集文件，遍历目录获取指定文件并生成 target。</p>
<p>然后我们执行命令开启 test 选项并指定 test 组编译运行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>xmake f -m debug --test<span style="color:#ff79c6">=</span>y
</span></span><span style="display:flex;"><span>xmake build -g <span style="color:#8be9fd;font-style:italic">test</span>
</span></span><span style="display:flex;"><span>xmake run -g <span style="color:#8be9fd;font-style:italic">test</span>
</span></span></code></pre></div><p>如果想一行<code>xmake test</code>命令搞定，可以使用<a class="link" href="https://xmake.io/#/zh-cn/manual/plugin_task"  target="_blank" rel="noopener"
    >task</a>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>task(<span style="color:#f1fa8c">&#34;test&#34;</span>)
</span></span><span style="display:flex;"><span>    on_run(<span style="color:#ff79c6">function</span> ()
</span></span><span style="display:flex;"><span>        os.exec(<span style="color:#f1fa8c">&#34;xmake f -m debug --test=y&#34;</span>)
</span></span><span style="display:flex;"><span>        os.exec(<span style="color:#f1fa8c">&#34;xmake build -g test&#34;</span>)
</span></span><span style="display:flex;"><span>        os.exec(<span style="color:#f1fa8c">&#34;xmake run -g test&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    set_menu{}
</span></span></code></pre></div><h3 id="库">库</h3>
<p>假如你要写一个库，给别人调用或者自己使用。</p>
<p>因为 xmake 没有类似 c++ namespace 的特性，可能 target/rule/option&hellip; 与自己的定义的名字发生冲突。而 xmake 有自己的包管理，只要贡献到 xmake-repo 别人就能使用，所以不推荐使用<code>includes</code>集成库。</p>
<ul>
<li>include</li>
</ul>
<p>需要安装的头文件，使用<code>add_headerfiles</code>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#6272a4">-- 保留头文件目录结构</span>
</span></span><span style="display:flex;"><span>add_headerfiles(<span style="color:#f1fa8c">&#34;include/(**.h)&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#6272a4">-- 丢弃文件目录结构，所有头文件都放在 include 目录</span>
</span></span><span style="display:flex;"><span>add_headerfiles(<span style="color:#f1fa8c">&#34;include/**.h&#34;</span>)
</span></span></code></pre></div><ul>
<li>lib</li>
</ul>
<p>基于 <a class="link" href="https://xmake.io/#/zh-cn/guide/project_examples?id=%e5%90%88%e5%b9%b6%e9%9d%99%e6%80%81%e5%ba%93"  target="_blank" rel="noopener"
    >build.merge_archive</a>，对某个 target 使用<code>set_policy(&quot;build.merge_archive&quot;, true)</code>，可以自动合并依赖的所有静态库。这样在发布的时候可以只安装一个静态库。</p>
<ul>
<li>bin</li>
</ul>
<p>在 Windows 上编译动态库，但又不想自己导出符号，可以使用<code>add_rules(&quot;utils.symbols.export_all&quot;)</code>自动导出所有符号（如果是 c++ 库还要给该规则传递参数<code>{export_classes = true}</code>）。</p>
<ul>
<li>如果需要安装其他文件，比如文档，使用<code>add_installfiles(&quot;doc/*.md&quot;, {prefixdir = &quot;share/doc&quot;})</code>。</li>
<li>导出该库给其他构建系统交互。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;utils.install.cmake_importfiles&#34;</span>)
</span></span><span style="display:flex;"><span>add_rules(<span style="color:#f1fa8c">&#34;utils.install.pkgconfig_importfiles&#34;</span>)
</span></span></code></pre></div><ul>
<li>想把这个库提交到 xmake-repo 上，还需要写对应的包描述脚本，这里只能参考<a class="link" href="https://xmake.io/#/zh-cn/package/remote_package?id=%e6%b7%bb%e5%8a%a0%e5%8c%85%e5%88%b0%e4%bb%93%e5%ba%93"  target="_blank" rel="noopener"
    >文档</a>和 xmake-repo 上其他包。</li>
</ul>
<h3 id="软件">软件</h3>
<p>如果要发布一个软件，基本上都要重写<code>on_install</code>脚本。</p>
<ul>
<li>因为不需要安装头文件，配置<code>add_headerfiles(&quot;src/xxx.h&quot;, {install = false})</code>。因为<code>add_headerfiles</code>这个接口不止用来安装头文件，还可以用作 ide 的工程目录显示（也就是说，如果不使用<code>add_headerfiles</code>，ide 工程目录只会显示源文件）。</li>
<li>xmake 内部封装了常用的<a class="link" href="https://xmake.io/#/zh-cn/manual/extension_modules?id=utilsarchive"  target="_blank" rel="noopener"
    >压缩工具</a>，在<code>on_install</code>最后一步可以把所有文件打包成压缩包。</li>
</ul>
<p>如果想用 upx 压缩也很简单。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>rule(<span style="color:#f1fa8c">&#34;module.program&#34;</span>)
</span></span><span style="display:flex;"><span>    after_build(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 判断是否使用 upx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> enabled <span style="color:#ff79c6">=</span> target:extraconf(<span style="color:#f1fa8c">&#34;rules&#34;</span>, <span style="color:#f1fa8c">&#34;module.program&#34;</span>, <span style="color:#f1fa8c">&#34;upx&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> enabled <span style="color:#ff79c6">or</span> target:kind() <span style="color:#ff79c6">~=</span> <span style="color:#f1fa8c">&#34;binary&#34;</span> <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> upx <span style="color:#ff79c6">=</span> assert(import(<span style="color:#f1fa8c">&#34;lib.detect.find_tool&#34;</span>)(<span style="color:#f1fa8c">&#34;upx&#34;</span>), <span style="color:#f1fa8c">&#34;upx not found!&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">-- 生成在 build 目录里</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> file <span style="color:#ff79c6">=</span> path.join(<span style="color:#f1fa8c">&#34;build&#34;</span>, path.filename(target:targetfile()))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        os.tryrm(file)
</span></span><span style="display:flex;"><span>        os.vrunv(upx.program, {target:targetfile(), <span style="color:#f1fa8c">&#34;-o&#34;</span>, file})
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span></code></pre></div><p>使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;main&#34;</span>)
</span></span><span style="display:flex;"><span>    set_kind(<span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    add_rules(<span style="color:#f1fa8c">&#34;module.program&#34;</span>, {upx <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>})
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span></code></pre></div><p>我们可以进一步优化这个 rule。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>rule(<span style="color:#f1fa8c">&#34;module.program&#34;</span>)
</span></span><span style="display:flex;"><span>    on_load(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        target:set(<span style="color:#f1fa8c">&#34;kind&#34;</span>, <span style="color:#f1fa8c">&#34;binary&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    after_build(<span style="color:#ff79c6">function</span> (target)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> enabled <span style="color:#ff79c6">=</span> target:extraconf(<span style="color:#f1fa8c">&#34;rules&#34;</span>, <span style="color:#f1fa8c">&#34;module.program&#34;</span>, <span style="color:#f1fa8c">&#34;upx&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">not</span> enabled) <span style="color:#ff79c6">or</span> (<span style="color:#ff79c6">not</span> is_mode(<span style="color:#f1fa8c">&#34;release&#34;</span>)) <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        import(<span style="color:#f1fa8c">&#34;core.project.depend&#34;</span>)
</span></span><span style="display:flex;"><span>        import(<span style="color:#f1fa8c">&#34;lib.detect.find_tool&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">local</span> targetfile <span style="color:#ff79c6">=</span> target:targetfile()
</span></span><span style="display:flex;"><span>        depend.on_changed(<span style="color:#ff79c6">function</span> ()
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">local</span> file <span style="color:#ff79c6">=</span> path.join(<span style="color:#f1fa8c">&#34;build&#34;</span>, path.filename(targetfile))
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">local</span> upx <span style="color:#ff79c6">=</span> assert(find_tool(<span style="color:#f1fa8c">&#34;upx&#34;</span>), <span style="color:#f1fa8c">&#34;upx not found!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            os.tryrm(file)
</span></span><span style="display:flex;"><span>            os.vrunv(upx.program, {targetfile, <span style="color:#f1fa8c">&#34;-o&#34;</span>, file})
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">end</span>, {files <span style="color:#ff79c6">=</span> targetfile})
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">end</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>target(<span style="color:#f1fa8c">&#34;main&#34;</span>)
</span></span><span style="display:flex;"><span>    add_rules(<span style="color:#f1fa8c">&#34;module.program&#34;</span>, {upx <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>})
</span></span><span style="display:flex;"><span>    add_files(<span style="color:#f1fa8c">&#34;*.cpp&#34;</span>)
</span></span></code></pre></div><p>在 target 的描述域中，<code>set_kind</code>也不需要写了。通过 <code>depend.on_changed</code> 接口，判断依赖文件的修改时间，避免每次重新构建。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/c&#43;&#43;/">C&#43;&#43;</a>
        
            <a href="/tags/xmake/">Xmake</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Aug 21, 2023
        </span>
    </section></footer>


    
</article>

    

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/p/xmake-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/">
        
        

        <div class="article-details">
            <h2 class="article-title">Xmake 常见问题解答</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/p/%E4%BD%BF%E7%94%A8-xmake-%E4%BD%9C%E4%B8%BA-cs149-%E4%BD%9C%E4%B8%9A%E7%9A%84-bulild-system/">
        
        

        <div class="article-details">
            <h2 class="article-title">使用 Xmake 作为 CS149 作业的 bulild system</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2022 - 
        
        2023 恒星的小站
    </section>
    
    <section class="powerby">
         <br />
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">目录</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#安装">安装</a></li>
    <li><a href="#hello-world">Hello world</a></li>
    <li><a href="#编码">编码</a>
      <ol>
        <li><a href="#visual-studio">Visual Studio</a></li>
        <li><a href="#visual-studio-code">Visual Studio Code</a></li>
        <li><a href="#clion">Clion</a></li>
        <li><a href="#其他">其他</a></li>
      </ol>
    </li>
    <li><a href="#hello-world-模板解析">Hello world 模板解析</a></li>
    <li><a href="#命令行解析">命令行解析</a>
      <ol>
        <li><a href="#通用操作">通用操作</a></li>
        <li><a href="#action-常用操作">action 常用操作</a></li>
      </ol>
    </li>
    <li><a href="#包管理">包管理</a>
      <ol>
        <li><a href="#使用">使用</a></li>
        <li><a href="#系统库">系统库</a></li>
        <li><a href="#非系统库远程依赖">非系统库（远程依赖）</a></li>
        <li><a href="#其他-1">其他</a></li>
      </ol>
    </li>
    <li><a href="#编写-xmakelua">编写 xmake.lua</a>
      <ol>
        <li><a href="#规范">规范</a></li>
        <li><a href="#作用域">作用域</a></li>
        <li><a href="#多级配置">多级配置</a></li>
        <li><a href="#目标依赖">目标依赖</a></li>
        <li><a href="#脚本域">脚本域</a></li>
        <li><a href="#规则">规则</a></li>
        <li><a href="#调试">调试</a></li>
      </ol>
    </li>
    <li><a href="#可能的最佳实践">可能的最佳实践</a>
      <ol>
        <li><a href="#单元测试">单元测试</a></li>
        <li><a href="#库">库</a></li>
        <li><a href="#软件">软件</a></li>
      </ol>
    </li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
